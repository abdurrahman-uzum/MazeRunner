These codes are utter mess since they have been written before I cared about any source/version control and I cannot be bothered to tidy them up now.